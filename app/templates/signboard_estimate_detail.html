{% extends "base.html" %}

{% block title %}è¦‹ç©ã‚‚ã‚Šè©³ç´°{% endblock %}
{% block header %}è¦‹ç©ã‚‚ã‚Šè©³ç´°{% endblock %}

{% block content %}
<div class="card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2 style="margin: 0;">{{ estimate[1] }}</h2>
    <div>
      {% if estimate[17] == 'draft' %}
      <span style="background: #e3f2fd; color: #1565c0; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">ä¸‹æ›¸ã</span>
      {% elif estimate[17] == 'sent' %}
      <span style="background: #fff3e0; color: #e65100; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">é€ä¿¡æ¸ˆ</span>
      {% elif estimate[17] == 'approved' %}
      <span style="background: #e8f5e9; color: #2e7d32; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">æ‰¿èªæ¸ˆ</span>
      {% elif estimate[17] == 'rejected' %}
      <span style="background: #ffebee; color: #c62828; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">å´ä¸‹</span>
      {% endif %}
    </div>
  </div>

  <div class="grid">
    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">åŸºæœ¬æƒ…å ±</h3>
      <table style="width: 100%; margin-top: 1rem;">
        <tr>
          <td style="padding: 0.5rem 0; width: 30%; color: #666;">è¦‹ç©ã‚‚ã‚Šç•ªå·:</td>
          <td style="padding: 0.5rem 0;"><strong>{{ estimate[1] }}</strong></td>
        </tr>
        <tr>
          <td style="padding: 0.5rem 0; color: #666;">é¡§å®¢å:</td>
          <td style="padding: 0.5rem 0;">{{ estimate[2] or '-' }}</td>
        </tr>
        <tr>
          <td style="padding: 0.5rem 0; color: #666;">ä½œæˆæ—¥æ™‚:</td>
          <td style="padding: 0.5rem 0;">{{ estimate[18].strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M') if estimate[18] else '-' }}</td>
        </tr>
      </table>
    </div>

    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">æ˜ç´°</h3>
      {% if items %}
      <div style="margin-top: 1rem;">
        {% for item in items %}
        <div style="border: 1px solid #ddd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; background: #f9f9f9;">
          <h4 style="margin: 0 0 0.5rem 0; color: #333;">{{ item[12] }}</h4>
          <table style="width: 100%; font-size: 0.9rem;">
            <tr>
              <td style="padding: 0.3rem 0; width: 40%; color: #666;">ã‚µã‚¤ã‚º:</td>
              <td style="padding: 0.3rem 0;">å¹… {{ item[2]|int }} mm Ã— é«˜ã• {{ item[3]|int }} mm</td>
            </tr>
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">é¢ç©:</td>
              <td style="padding: 0.3rem 0;">{{ "%.4f"|format(item[5]) }} ã¡</td>
            </tr>
            {% if item[6] %}
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">é‡é‡:</td>
              <td style="padding: 0.3rem 0;">{{ "%.2f"|format(item[6]) }} kg</td>
            </tr>
            {% endif %}
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">æ•°é‡:</td>
              <td style="padding: 0.3rem 0;">{{ item[4] }}</td>
            </tr>
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">å˜ä¾¡:</td>
              <td style="padding: 0.3rem 0;">
                Â¥{{ "{:,}".format(item[8]|int) }}
                {% if item[7] == 'area' %}
                / ã¡
                {% else %}
                / kg
                {% endif %}
              </td>
            </tr>
            {% if item[9] > 0 %}
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">å‰²å¼•ç‡:</td>
              <td style="padding: 0.3rem 0; color: #d32f2f;">{{ "%.2f"|format(item[9]) }}%</td>
            </tr>
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">å‰²å¼•å¾Œå˜ä¾¡:</td>
              <td style="padding: 0.3rem 0;">
                Â¥{{ "{:,}".format(item[10]|int) }}
                {% if item[7] == 'area' %}
                / ã¡
                {% else %}
                / kg
                {% endif %}
              </td>
            </tr>
            {% endif %}
            <tr style="border-top: 1px solid #ccc;">
              <td style="padding: 0.5rem 0;"><strong>å°è¨ˆ:</strong></td>
              <td style="padding: 0.5rem 0;"><strong>Â¥{{ "{:,}".format(item[11]|int) }}</strong></td>
            </tr>
          </table>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p style="margin-top: 1rem; color: #999;">æ˜ç´°ãŒã‚ã‚Šã¾ã›ã‚“</p>
      {% endif %}
    </div>

    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">åˆè¨ˆé‡‘é¡</h3>
      <table style="width: 100%; margin-top: 1rem;">
        <tr style="border-top: 1px solid #ddd;">
          <td style="padding: 0.75rem 0; color: #666; width: 40%;"><strong>å°è¨ˆ:</strong></td>
          <td style="padding: 0.75rem 0; text-align: right;"><strong>Â¥{{ "{:,}".format(estimate[12]|int) }}</strong></td>
        </tr>
        <tr>
          <td style="padding: 0.5rem 0; color: #666;">æ¶ˆè²»ç¨ï¼ˆ{{ (estimate[13] * 100)|int }}%ï¼‰:</td>
          <td style="padding: 0.5rem 0; text-align: right;">Â¥{{ "{:,}".format(estimate[14]|int) }}</td>
        </tr>
        <tr style="border-top: 2px solid #333;">
          <td style="padding: 0.75rem 0;"><strong style="font-size: 1.1rem;">åˆè¨ˆé‡‘é¡:</strong></td>
          <td style="padding: 0.75rem 0; text-align: right;"><strong style="font-size: 1.3rem; color: #1976d2;">Â¥{{ "{:,}".format(estimate[15]|int) }}</strong></td>
        </tr>
      </table>
    </div>

    {% if estimate[16] %}
    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">å‚™è€ƒ</h3>
      <p style="margin-top: 1rem; white-space: pre-wrap;">{{ estimate[16] }}</p>
    </div>
    {% endif %}
    
    {% if blueprint_images %}
    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">è§£æã—ãŸç”»åƒ</h3>
      <div style="margin-top: 1rem;">
        {% for image in blueprint_images %}
        <div style="margin-bottom: 0.5rem;">
          <a href="{{ image[2] }}" target="_blank" style="color: #1976d2; text-decoration: none;">
            ğŸ“ {{ image[1] }}
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endif %}
  </div>
</div>

<div style="margin-top: 1rem;">
  <a href="{{ url_for('signboard.index') }}" class="btn">ä¸€è¦§ã«æˆ»ã‚‹</a>
</div>
{% endblock %}
