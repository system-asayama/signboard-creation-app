{% extends "base.html" %}

{% block title %}見積もり詳細{% endblock %}
{% block header %}見積もり詳細{% endblock %}

{% block content %}
<div class="card">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
    <h2 style="margin: 0;">{{ estimate[1] }}</h2>
    <div>
      {% if estimate[17] == 'draft' %}
      <span style="background: #e3f2fd; color: #1565c0; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">下書き</span>
      {% elif estimate[17] == 'sent' %}
      <span style="background: #fff3e0; color: #e65100; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">送信済</span>
      {% elif estimate[17] == 'approved' %}
      <span style="background: #e8f5e9; color: #2e7d32; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">承認済</span>
      {% elif estimate[17] == 'rejected' %}
      <span style="background: #ffebee; color: #c62828; padding: 0.5rem 1rem; border-radius: 8px; font-weight: 600;">却下</span>
      {% endif %}
    </div>
  </div>

  <div class="grid">
    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">基本情報</h3>
      <table style="width: 100%; margin-top: 1rem;">
        <tr>
          <td style="padding: 0.5rem 0; width: 30%; color: #666;">見積もり番号:</td>
          <td style="padding: 0.5rem 0;"><strong>{{ estimate[1] }}</strong></td>
        </tr>
        <tr>
          <td style="padding: 0.5rem 0; color: #666;">顧客名:</td>
          <td style="padding: 0.5rem 0;">{{ estimate[2] or '-' }}</td>
        </tr>
        <tr>
          <td style="padding: 0.5rem 0; color: #666;">作成日時:</td>
          <td style="padding: 0.5rem 0;">{{ estimate[18].strftime('%Y年%m月%d日 %H:%M') if estimate[18] else '-' }}</td>
        </tr>
      </table>
    </div>

    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">明細</h3>
      {% if items %}
      <div style="margin-top: 1rem;">
        {% for item in items %}
        <div style="border: 1px solid #ddd; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; background: #f9f9f9;">
          <h4 style="margin: 0 0 0.5rem 0; color: #333;">{{ item[12] }}</h4>
          <table style="width: 100%; font-size: 0.9rem;">
            <tr>
              <td style="padding: 0.3rem 0; width: 40%; color: #666;">サイズ:</td>
              <td style="padding: 0.3rem 0;">幅 {{ item[2]|int }} mm × 高さ {{ item[3]|int }} mm</td>
            </tr>
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">面積:</td>
              <td style="padding: 0.3rem 0;">{{ "%.4f"|format(item[5]) }} ㎡</td>
            </tr>
            {% if item[6] %}
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">重量:</td>
              <td style="padding: 0.3rem 0;">{{ "%.2f"|format(item[6]) }} kg</td>
            </tr>
            {% endif %}
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">数量:</td>
              <td style="padding: 0.3rem 0;">{{ item[4] }}</td>
            </tr>
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">単価:</td>
              <td style="padding: 0.3rem 0;">
                ¥{{ "{:,}".format(item[8]|int) }}
                {% if item[7] == 'area' %}
                / ㎡
                {% else %}
                / kg
                {% endif %}
              </td>
            </tr>
            {% if item[9] > 0 %}
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">割引率:</td>
              <td style="padding: 0.3rem 0; color: #d32f2f;">{{ "%.2f"|format(item[9]) }}%</td>
            </tr>
            <tr>
              <td style="padding: 0.3rem 0; color: #666;">割引後単価:</td>
              <td style="padding: 0.3rem 0;">
                ¥{{ "{:,}".format(item[10]|int) }}
                {% if item[7] == 'area' %}
                / ㎡
                {% else %}
                / kg
                {% endif %}
              </td>
            </tr>
            {% endif %}
            <tr style="border-top: 1px solid #ccc;">
              <td style="padding: 0.5rem 0;"><strong>小計:</strong></td>
              <td style="padding: 0.5rem 0;"><strong>¥{{ "{:,}".format(item[11]|int) }}</strong></td>
            </tr>
          </table>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p style="margin-top: 1rem; color: #999;">明細がありません</p>
      {% endif %}
    </div>

    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">合計金額</h3>
      <table style="width: 100%; margin-top: 1rem;">
        <tr style="border-top: 1px solid #ddd;">
          <td style="padding: 0.75rem 0; color: #666; width: 40%;"><strong>小計:</strong></td>
          <td style="padding: 0.75rem 0; text-align: right;"><strong>¥{{ "{:,}".format(estimate[12]|int) }}</strong></td>
        </tr>
        <tr>
          <td style="padding: 0.5rem 0; color: #666;">消費税（{{ (estimate[13] * 100)|int }}%）:</td>
          <td style="padding: 0.5rem 0; text-align: right;">¥{{ "{:,}".format(estimate[14]|int) }}</td>
        </tr>
        <tr style="border-top: 2px solid #333;">
          <td style="padding: 0.75rem 0;"><strong style="font-size: 1.1rem;">合計金額:</strong></td>
          <td style="padding: 0.75rem 0; text-align: right;"><strong style="font-size: 1.3rem; color: #1976d2;">¥{{ "{:,}".format(estimate[15]|int) }}</strong></td>
        </tr>
      </table>
    </div>

    {% if estimate[16] %}
    <div>
      <h3 style="border-bottom: 2px solid #333; padding-bottom: 0.5rem;">備考</h3>
      <p style="margin-top: 1rem; white-space: pre-wrap;">{{ estimate[16] }}</p>
    </div>
    {% endif %}
  </div>
</div>

<div style="margin-top: 1rem;">
  <a href="{{ url_for('signboard.index') }}" class="btn">一覧に戻る</a>
</div>
{% endblock %}
