# 従業員有効/無効切り替え機能 - 問題調査レポート

## 問題の症状

従業員一覧ページで、「有効」列に「無効」とテキストのみが表示され、有効/無効を切り替えるボタンが表示されない。

## 根本原因

データベースに`active`カラムが追加されていなかったため、テンプレートで`e.active`が`None`となり、ボタンが表示されませんでした。

## 実施した対策

### 1. データベースへの手動マイグレーション

```sql
ALTER TABLE "T_従業員" ADD COLUMN active INTEGER DEFAULT 1;
UPDATE "T_従業員" SET active = 1 WHERE active IS NULL;
```

このコマンドを実行して、本番環境のデータベースに`active`カラムを追加しました。

### 2. 自動マイグレーションが動作しなかった理由

- **init_schema関数の自動マイグレーション**: 実装されていたが、アプリケーション起動時に実行されなかった
- **releaseフェーズのマイグレーション**: Procfileに設定されていたが、実行されなかった（ログに記録なし）

### 3. 今後の推奨事項

1. **マイグレーションの確認**: デプロイ後、必ずHerokuのログを確認して、マイグレーションが実行されたか確認する
2. **手動マイグレーションの準備**: 自動マイグレーションが失敗した場合に備えて、手動でマイグレーションを実行する手順を準備する
3. **データベーススキーマの確認**: 新機能をデプロイする前に、データベーススキーマを確認して、必要なカラムが存在するか確認する

## 次のステップ

データベースに`active`カラムが追加されたので、ブラウザで従業員一覧ページをリロードして、ボタンが表示されるか確認する必要があります。
